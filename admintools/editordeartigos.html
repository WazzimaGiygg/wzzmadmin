<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>WZZM WIKI ZONE ZERO MOD - Artigos e Matérias</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <!-- Tailwind CSS CDN: OK for development, but use as a PostCSS plugin for production -->
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      font-family: 'Inter', sans-serif;
    }
    /* Estilos para ocultar/mostrar elementos */
    .hidden {
      display: none;
    }
  </style>
</head>
<body class="bg-gray-100 min-h-screen py-8">
  <div class="max-w-6xl mx-auto px-4">
    <h1 class="text-2xl font-semibold text-center text-gray-800 mb-8">Matérias de Graduação: Pesquisa e Análise de Dados</h1>

    <!-- Seção de Autenticação -->
    <div id="auth-section" class="max-w-md mx-auto bg-white rounded-lg shadow p-6 mb-8 text-center">
      <h2 class="text-xl font-semibold text-gray-700 mb-4" id="auth-title"></h2>
      <div id="auth-buttons" class="flex flex-col items-center gap-4">
        <button
          type="button"
          id="google-login-btn"
          class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline w-full max-w-xs"
        >
          Entrar com Google
        </button>
        <button
          type="button"
          id="logout-btn"
          class="bg-red-500 hover:bg-red-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline hidden w-full max-w-xs"
        >
          Sair
        </button>
      </div>
      <p id="auth-message" class="mt-4 text-sm"></p>
      <div id="user-status" class="mt-4 text-gray-700 text-sm"></div>
    </div>

    <!-- Seção para Adicionar Artigo (Visível apenas para Admins no frontend) -->
    <!-- A visibilidade é controlada pelo JS, mas as regras do Firestore dão a garantia final -->
    <div id="add-article-section" class="max-w-md mx-auto bg-white rounded-lg shadow p-6 mt-8 hidden">
      <h2 class="text-xl font-semibold text-gray-700 mb-4">Adicionar Novo Artigo</h2>
      <form id="add-article-form">
        <div class="mb-4">
          <label for="newTitulo" class="block text-gray-700 text-sm font-bold mb-2">Título:</label>
          <input
            type="text"
            id="newTitulo"
            class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
            required
          />
        </div>
        <div class="mb-4">
          <label for="newDescricao" class="block text-gray-700 text-sm font-bold mb-2">Descrição:</label>
          <textarea
            id="newDescricao"
            class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
            rows="3"
            required
          ></textarea>
        </div>
        <div class="mb-4">
          <label for="newLink" class="block text-gray-700 text-sm font-bold mb-2">Link (URL):</label>
          <input
            type="url"
            id="newLink"
            class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
            required
          />
        </div>
        <div class="mb-4">
          <label for="newCategoria" class="block text-gray-700 text-sm font-bold mb-2">Categoria:</label>
          <input
            type="text"
            id="newCategoria"
            class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
            required
          />
        </div>
        <div class="mb-4">
          <label for="newAcesso" class="block text-gray-700 text-sm font-bold mb-2">Acesso:</label>
          <select
            id="newAcesso"
            class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
          >
            <option value="publico">Público</option>
            <option value="admin">Admin</option>
          </select>
        </div>
        <button
          type="submit"
          class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline"
        >
          Adicionar Artigo
        </button>
      </form>
      <p id="form-message" class="mt-4 text-sm"></p>
    </div>

    <!-- Seção para Exibir Artigos -->
    <div id="content-sections" class="mt-8">
      <p>Carregando conteúdo...</p>
    </div>

  </div>

  <!-- SDKs do Firebase (versão compat) -->
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-analytics-compat.js"></script>

  <script>
    // 1. Sua configuração do Firebase (copiada do seu console)
    // VERIFIQUE SE ESTA CONFIGURAÇÃO CORRESPONDE EXATAMENTE AO SEU PROJETO WZZM
    const firebaseConfig = {
      apiKey: "AIzaSyB9GkSqTIZ0kbVsba_WOdQeVAETrF9qna0", // Seu API Key
      authDomain: "wzzm-ce3fc.firebaseapp.com",      // Seu Auth Domain
      projectId: "wzzm-ce3fc",                       // Seu Project ID
      storageBucket: "wzzm-ce3fc.firebasestorage.app", // Seu Storage Bucket
      messagingSenderId: "249427877153",           // Seu Sender ID
      appId: "1:249427877153:web:0e4297294794a5aadeb260", // Seu App ID
      measurementId: "G-PLKNZNFCQ8"                  // Seu Measurement ID (Analytics)
    };

    // Inicialize o Firebase com a configuração do seu projeto
    const app = firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();
    // Inicializa o Analytics se o Measurement ID estiver na config
    // Este bloco `if` é opcional, mas evita erro se Measurement ID não estiver definido
    let analytics = null;
    if (firebaseConfig.measurementId) {
      analytics = firebase.analytics();
    }


    // Referências aos elementos HTML
    const authTitle = document.getElementById('auth-title');
    const googleLoginBtn = document.getElementById('google-login-btn');
    const logoutBtn = document.getElementById('logout-btn');
    const authMessage = document.getElementById('auth-message');
    const userStatusDiv = document.getElementById('user-status');
    const addArticleSection = document.getElementById('add-article-section');
    const addArticleForm = document.getElementById('add-article-form');
    const formMessage = document.getElementById('form-message');
    const contentSectionsDiv = document.getElementById('content-sections');

    // Flag para verificar se o usuário é admin (estado local no frontend)
    let isAdminUser = false;

    // 2. Função para verificar se um usuário é administrador CONSULTANDO O FIRESTORE
    // Esta função espelha a lógica da função isAdmin() nas suas regras de segurança
    async function checkAdminStatus(uid) {
      if (!uid) {
        isAdminUser = false;
        return false;
      }
      try {
        // Tenta obter o documento com o UID do usuário na coleção 'admins'
        const adminDoc = await db.
