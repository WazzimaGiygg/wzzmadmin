
<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wiki Zone Zero Mod</title>
    <link rel="icon" href="favicom.png" type="image/x-icon">
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <link rel="stylesheet" href="https://code.getmdl.io/1.3.0/material.indigo-pink.min.css">
    <style id="custom-app-css">
        /* Este será o local onde o CSS dos aplicativos do usuário será injetado */
    </style>
    <style>
        /* Seus estilos CSS existentes aqui */
        body {
            display: flex; /* cite: 2 */
            flex-direction: column; /* cite: 3 */
            min-height: 100vh; /* cite: 4 */
            margin: 0; /* cite: 5 */
            font-family: 'Roboto', sans-serif; /* cite: 6 */
            background-color: #f5f5f5; /* cite: 7 */
        }
        .mdl-layout__content {
            flex-grow: 1; /* cite: 8 */
            display: flex; /* cite: 9 */
            flex-direction: column; /* cite: 10 */
            padding: 0; /* cite: 11 */
        }
        .page-content {
            flex-grow: 1; /* cite: 12 */
            display: flex; /* cite: 13 */
            flex-direction: column; /* cite: 14 */
        }
        .mdl-layout__drawer .mdl-navigation .mdl-navigation__link {
            color: #424242; /* cite: 16 */
        }
        .mdl-layout__drawer .mdl-navigation .mdl-navigation__link[data-requires-auth="true"] {
            color: #9e9e9e; /* cite: 17 */
            pointer-events: none; /* cite: 18 */
        }

        iframe {
            flex-grow: 1; /* cite: 19 */
            border: none; /* cite: 20 */
            width: 100%; /* cite: 21 */
        }
        .mdl-layout__header-row {
            padding: 0 16px; /* cite: 22 */
        }
        .mdl-layout__header-row .mdl-navigation {
            display: flex; /* cite: 23 */
            align-items: center; /* cite: 24 */
        }
        .mdl-layout__header-row .mdl-navigation .mdl-navigation__link {
            padding: 0 12px; /* cite: 25 */
        }

        /* Estilo para a imagem de perfil */
        #user-profile-pic {
            width: 32px; /* cite: 26 */
            height: 32px; /* cite: 26 */
            border-radius: 50%;
            margin-left: 8px;
            vertical-align: middle;
            display: none; /* cite: 27 */
        }

        /* Estilos para o popup de apps */
        #google-apps-button {
            display: none; /* cite: 28 */
        }
        #google-apps-popup {
            display: none; /* cite: 29 */
            position: absolute; /* cite: 29 */
            top: 48px; /* Altura do header */
            right: 0; /* cite: 30 */
            width: 300px; /* cite: 30 */
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            z-index: 1000;
            padding: 10px;
            box-sizing: border-box; /* cite: 31 */
        }
        #google-apps-popup h4 {
            margin-top: 0; /* cite: 32 */
            margin-bottom: 10px; /* cite: 32 */
            color: #3f51b5;
            text-align: center;
        }
        #app-grid {
            display: grid; /* cite: 33 */
            grid-template-columns: repeat(3, 1fr); /* cite: 33 */
            gap: 10px;
            padding: 10px;
        }
        .app-item {
            display: flex; /* cite: 34 */
            flex-direction: column; /* cite: 34 */
            align-items: center;
            text-align: center;
            cursor: pointer;
            padding: 8px;
            border-radius: 4px;
            transition: background-color 0.3s; /* cite: 35 */
        }
        .app-item:hover {
            background-color: #f0f0f0; /* cite: 36 */
        }
        .app-item img {
            width: 48px; /* cite: 37 */
            height: 48px; /* cite: 37 */
            margin-bottom: 5px;
        }
        .app-item span {
            font-size: 0.8em; /* cite: 38 */
            color: #555; /* cite: 38 */
        }

        /* Removidos estilos para contador de notificações */
        /* Removidos estilos para o popup do centro de notificações */

        /* Mensagens de acesso */
        #access-denied-message, #banned-message {
            display: none; /* cite: 39 */
            position: fixed; /* cite: 39 */
            top: 50%; /* cite: 39 */
            left: 50%; /* cite: 39 */
            transform: translate(-50%, -50%); /* cite: 39 */
            background-color: #ffe0b2; /* cite: 40 */
            border: 1px solid #ffb74d; /* cite: 41 */
            padding: 20px;
            border-radius: 8px; /* cite: 42 */
            box-shadow: 0 4px 8px rgba(0,0,0,0.2); /* cite: 42 */
            text-align: center;
            color: #e65100; /* Laranja escuro */
            font-weight: bold; /* cite: 43 */
            z-index: 1001; /* cite: 43 */
        }

        /* --- ESTILOS PARA NOTÍCIAS (Botão e Popup) --- */
        #news-button {
            margin-right: 8px; /* cite: 44 */
            display: none; /* cite: 44 */
        }

        #news-center-popup {
            display: none; /* cite: 45 */
            position: absolute; /* cite: 45 */
            top: 48px; /* cite: 45 */
            right: 0; /* cite: 45 */
            width: 400px; /* Ajuste a largura conforme necessário */
            max-height: 80vh; /* cite: 46 */
            background-color: white; /* cite: 46 */
            border-radius: 8px; /* cite: 46 */
            box-shadow: 0 5px 15px rgba(0,0,0,0.3); /* cite: 46 */
            z-index: 998; /* cite: 46 */
            flex-direction: column; /* cite: 46 */
            overflow: hidden; /* cite: 47 */
        }

        #news-popup-header {
            background-color: #3f51b5; /* cite: 48 */
            color: white; /* cite: 48 */
            padding: 10px 15px; /* cite: 48 */
            border-top-left-radius: 8px; /* cite: 48 */
            border-top-right-radius: 8px; /* cite: 48 */
            display: flex; /* cite: 48 */
            align-items: center; /* cite: 48 */
            justify-content: space-between; /* cite: 48 */
            font-weight: bold; /* cite: 48 */
            font-size: 16px; /* cite: 49 */
        }

        #news-popup-header .close-button {
            background: none; /* cite: 50 */
            border: none; /* cite: 50 */
            color: white; /* cite: 50 */
            font-size: 24px; /* cite: 50 */
            cursor: pointer; /* cite: 50 */
            padding: 0; /* cite: 51 */
        }

        #news-popup-content {
            flex-grow: 1; /* cite: 52 */
            overflow-y: auto; /* cite: 52 */
            padding: 15px; /* cite: 52 */
        }

        #news-popup-footer {
            padding: 10px 15px; /* cite: 53 */
            border-top: 1px solid #eee; /* cite: 53 */
            text-align: center; /* cite: 53 */
        }

        #news-popup-footer button {
            width: 100%; /* cite: 54 */
        }

        /* Estilos para os itens de notícia dentro do popup (adaptados do seu código original) */
        .news-popup-item {
            background-color: #f9f9f9; /* cite: 55 */
            border: 1px solid #e0e0e0; /* cite: 55 */
            border-radius: 4px; /* cite: 55 */
            padding: 15px; /* cite: 55 */
            margin-bottom: 15px; /* cite: 55 */
            box-shadow: 0 1px 1px 0 rgba(0,0,0,.08); /* cite: 56 */
        }
        .news-popup-item h3 {
            margin-top: 0; /* cite: 57 */
            color: #5c6bc0; /* cite: 57 */
        }
        .news-popup-item p {
            color: #555; /* cite: 58 */
            line-height: 1.5; /* cite: 58 */
        }
        .news-popup-item small {
            font-size: 0.8em; /* cite: 59 */
            color: #888; /* cite: 59 */
            display: block; /* cite: 59 */
            margin-top: 10px; /* cite: 59 */
        }
        .news-popup-item img {
            max-width: 100%; /* cite: 60 */
            height: auto; /* cite: 60 */
            margin-top: 10px; /* cite: 60 */
            border-radius: 4px; /* cite: 60 */
        }

        /* Removidos estilos para Chat Popup */

	    #window-container {
    position: relative;
    width: 100%;
    height: 100%;
    flex: 1;
    overflow: visible;
}

.floating-window {
    position: absolute;
    top: 60px;
    left: 60px;
    width: 650px;
    height: 450px;
    min-width: 320px;
    min-height: 200px;
    background: #fff;
    border: 2px solid #3f51b5;
    border-radius: 8px;
    box-shadow: 0 8px 24px rgba(0,0,0,0.20);
    z-index: 999;
    display: flex;
    flex-direction: column;
    overflow: hidden;
    resize: both;
}

.window-header {
    background: #3f51b5;
    color: #fff;
    cursor: move;
    padding: 8px 12px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    font-weight: bold;
    user-select: none;
}

.window-controls {
    display: flex;
    gap: 4px;
}

.window-controls button {
    background: none;
    border: none;
    color: #fff;
    font-size: 18px;
    cursor: pointer;
    margin-left: 4px;
    padding: 0 4px;
    border-radius: 3px;
    transition: background 0.2s;
}
.window-controls button:hover {
    background: rgba(255,255,255,0.18);
}

.window-body {
    flex: 1;
    overflow: hidden;
    display: flex;
}
.window-body iframe {
    border: none;
    width: 100%;
    height: 100%;
}
    </style>
</head>
<body>
    <div class="mdl-layout mdl-js-layout mdl-layout--fixed-header">
        <header class="mdl-layout__header">
            <div class="mdl-layout__header-row">
                <span class="mdl-layout-title">Wiki Zone Zero Mod</span>
		        <a href="https://wikizero.wzzm.org/" id="./wikinotpedia/"> 
                <img src="https://wzzm.org/wnp.png" alt="Logo Wiki Zone Zero Mod" style="height: 32px; vertical-align: middle; margin-right: 8px;"></a> <div class="mdl-layout-spacer"></div>
                <nav class="mdl-navigation">
                    <a class="mdl-navigation__link" href="#" onclick="loadPage('recepcao.html', false)">Início</a>
                    <div style="position: relative; display: flex; align-items: center;">
                        <button class="mdl-button mdl-js-button mdl-button--icon" id="news-button" style="display: none;">
                            <i class="material-icons">article</i>
                        </button>
                        <div id="news-center-popup">
                            <div id="news-popup-header">
                                <span>Últimas Notícias</span>
                                <button class="close-button" id="close-news-popup-button">×</button>
                            </div>
                            <div id="news-popup-content">
                                <p>Carregando últimas notícias...</p>
                            </div>
                            <div id="news-popup-footer">
                                <button id="view-all-news-button" class="mdl-button mdl-js-button mdl-button--raised mdl-button--accent">
                                    Ver todas as Notícias
                                </button>
                            </div>
                        </div>

                        <button class="mdl-button mdl-js-button mdl-button--icon" id="google-apps-button" style="display: none;">
                            <i class="material-icons">widgets</i>
                        </button>
                        <div id="google-apps-popup">
                            <h4>Serviços WZZM</h4> 
                            <div id="app-grid">
                                </div>
                        </div>

                        <div id="user-info-container" style="display: none; align-items: center;"> <span id="user-info" style="margin-left: 8px; color: white;"></span> <img id="user-profile-pic" src="" alt="Profile Pic">
                            <button class="mdl-button mdl-js-button mdl-button--raised mdl-button--colored" id="logout-button" style="margin-left: 10px; display: none;">Sair</button> </div>
                        <button class="mdl-button mdl-js-button mdl-button--raised mdl-button--colored" id="login-google">Login Google</button>
                        <button class="mdl-button mdl-js-button mdl-button--raised mdl-button--colored" id="login-github" style="margin-left: 10px;">Login GitHub</button>
                    </div>
                </nav>
            </div>
        </header>
        <div class="mdl-layout__drawer">
            <span class="mdl-layout-title">Navegação</span>
            <nav class="mdl-navigation">

<!-- Área dos Menus -->

  <a class="mdl-navigation__link" href="#" onclick="loadPage('recepcao.html', false)">Página Inicial</a>

<a class="mdl-navigation__link" href="#" onclick="loadPage('admintools/editordeartigos.html', false)">Adicionar Artigo</a>

<a class="mdl-navigation__link" href="#" onclick="loadPage('register-material.html', false)">Registrar Matéria</a>

<a class="mdl-navigation__link" href="#" onclick="loadPage('conhecawazzimagiygg.html', false)">Conheça WazzimaGiygg</a>

<a class="mdl-navigation__link" href="#" onclick="loadPage('admintools/cadastrarprofessor.html', false)">Cadastrar Professor</a>

<a class="mdl-navigation__link" href="#" onclick="loadPage('detalhes_cliente/', false)">Procurar informações sobre Cliente</a>

<a class="mdl-navigation__link" href="#" onclick="loadPage('admintools/editordenoticias.html', false)">Adicionar Notícia</a>

<a class="mdl-navigation__link" href="#" onclick="loadPage('administrarcustos/', false)">Administrar Custos</a>

<a class="mdl-navigation__link" href="#" onclick="loadPage('admintools/configuracoes.html', false)">Configurações</a>

<a class="mdl-navigation__link" href="#" onclick="loadPage('admintools/estatisticas.html', false)">Estatísticas</a>

<a class="mdl-navigation__link" href="#" onclick="loadPage('admintools/pageadmin.html', false)">Página Administradora</a>

<a class="mdl-navigation__link" href="#" onclick="loadPage('admintools/adminusers.html', false)">Página Gerenciadora de Usuários</a>

<a class="mdl-navigation__link" href="#" onclick="loadPage('gerenciarusuarios/', false)">Página Gerenciadora de Usuários</a>

		    


            </nav>
        </div>
        <div id="window-container"></div>
            <div id="access-denied-message" style="display:none;">
                <p>Acesso negado. Por favor, faça login para ver este conteúdo.</p> </div>
            <div id="banned-message" style="display:none;">
                <p>Sua conta foi banida. Você não pode acessar o conteúdo.</p> <p>Para mais informações, contate o suporte.</p>
            </div>
            
        </main>
    </div>

    <script defer src="https://code.getmdl.io/1.3.0/material.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-analytics-compat.js"></script>
    <script>
        // --- Configuração do Firebase ---
        const firebaseConfig = {
            apiKey: "AIzaSyB9GkSqTIZ0kbVsba_WOdQeVAETrF9qna0", // Use sua própria chave! /* cite: 79 */
            authDomain: "wzzm-ce3fc.firebaseapp.com", /* cite: 79 */
            projectId: "wzzm-ce3fc", /* cite: 79 */
            storageBucket: "wzzm-ce3fc.appspot.com", /* cite: 79 */
            messagingSenderId: "249427877153", /* cite: 79 */
            appId: "1:249427877153:web:0e4297294794a5aadeb260", /* cite: 79 */
            measurementId: "G-PLKNZNFCQ8" /* cite: 79 */
        };
        // Inicialize Firebase
        const app = firebase.initializeApp(firebaseConfig); /* cite: 80 */
        const auth = firebase.auth(); /* cite: 81 */
        const firestore = firebase.firestore(); /* cite: 81 */
        firebase.analytics(); /* cite: 81 */

        // Variáveis globais para estado do usuário
        let currentUser = null; /* cite: 82 */
        let isCurrentUserBanned = false; /* cite: 82 */
        // let unsubscribeNotifications = null; // REMOVED

        // --- Funções Auxiliares ---
        function loadPage(src, requiresAuth = false) {
            const contentFrame = document.getElementById('contentFrame'); /* cite: 83 */
            const accessDeniedMessage = document.getElementById('access-denied-message'); /* cite: 83 */
            const bannedMessage = document.getElementById('banned-message'); /* cite: 83 */

            // Verifica se o usuário está banido
            if (isCurrentUserBanned && src !== 'recepcao.html' && src !== 'POLÍTICAS GERAIS DO WIKI ZONE ZERO MOD.pdf') { // Permite ver recepcao e políticas mesmo banido
                contentFrame.style.display = 'none'; /* cite: 84 */
                accessDeniedMessage.style.display = 'none'; /* cite: 84 */
                bannedMessage.style.display = 'block'; /* cite: 84 */
                return;
            }

            // Verifica se a página requer autenticação e o usuário não está logado
            if (requiresAuth && !currentUser) {
                contentFrame.style.display = 'none'; /* cite: 85 */
                bannedMessage.style.display = 'none'; /* cite: 85 */
                accessDeniedMessage.style.display = 'block'; /* cite: 85 */
                return;
            }

            // Se não houver restrição, carrega a página
            contentFrame.style.display = 'block'; /* cite: 86 */
            accessDeniedMessage.style.display = 'none'; /* cite: 86 */
            bannedMessage.style.display = 'none'; /* cite: 86 */
            contentFrame.src = src; /* cite: 86 */
        }

        // Função para ativar/desativar links de navegação com base no status de login
        function setNavLinksEnabled(enabled) {
            const navLinks = document.querySelectorAll('.mdl-navigation__link[data-requires-auth="true"]'); /* cite: 87 */
            navLinks.forEach(link => {
                if (enabled) {
                    link.style.pointerEvents = 'auto';
                    link.style.color = '#424242'; // Cor padrão
                } else {
                    link.style.pointerEvents = 'none'; /* cite: 88 */
                    link.style.color = '#9e9e9e'; /* cite: 88 */
                }
            }); /* cite: 89 */
        }

        // Função para criar/atualizar o documento do perfil do usuário no Firestore
        async function createUserProfileDocument(user) {
            if (!user) return; /* cite: 90 */
            const userRef = firestore.doc(`users/${user.uid}`); /* cite: 90 */
            const snapshot = await userRef.get(); /* cite: 90 */

            if (!snapshot.exists) {
                const { displayName, email, photoURL } = user; /* cite: 91 */
                const createdAt = new Date(); /* cite: 91 */

                try {
                    await userRef.set({
                        displayName,
                        email,
                        photoURL,
                        createdAt, /* cite: 92 */
                        isAdmin: false, // Define como false por padrão
                        isBan: false // Define como false por padrão
                    }); /* cite: 93 */
                    console.log("Perfil do usuário criado no Firestore."); /* cite: 94 */
                } catch (error) {
                    console.error("Erro ao criar perfil do usuário:", error); /* cite: 95 */
                }
            }
        }

        // Função para carregar e aplicar CSS de aplicativos específicos do usuário
        async function loadAndApplyUserAppsCSS(userId) {
            const customAppCssStyleTag = document.getElementById('custom-app-css'); /* cite: 96 */
            if (!customAppCssStyleTag) return; /* cite: 96 */

            try {
                const userAppsSnapshot = await firestore.collection('userApps').doc(userId).get(); /* cite: 97 */
                if (userAppsSnapshot.exists) {
                    const appData = userAppsSnapshot.data(); /* cite: 98 */
                    let cssContent = ''; /* cite: 98 */
                    if (appData && appData.apps) {
                        appData.apps.forEach(app => {
                            if (app.css) {
                                cssContent += app.css + '\n'; /* cite: 99 */
                            }
                        });
                    }
                    customAppCssStyleTag.innerHTML = cssContent; /* cite: 100 */
                } else {
                    customAppCssStyleTag.innerHTML = ''; /* cite: 101 */
                }
            } catch (error) {
                console.error("Erro ao carregar CSS de aplicativos do usuário:", error); /* cite: 103 */
                customAppCssStyleTag.innerHTML = ''; /* cite: 103 */
            }
        }

        // Removidas funções relacionadas a notificações: updateNotificationBadge, listenForNotifications, showNotificationsPopup, hideNotificationsPopup

        // --- FUNÇÕES PARA O POPUP DE NOTÍCIAS (MANTIDAS) ---
        function showNewsPopup() {
            const newsCenterPopup = document.getElementById('news-center-popup'); /* cite: 104 */
            if (newsCenterPopup) {
                newsCenterPopup.style.display = 'flex'; /* cite: 105 */
                fetchLatestNews(); // Fetch news when popup is shown
            }
        }

        function hideNewsPopup() {
            const newsCenterPopup = document.getElementById('news-center-popup'); /* cite: 106 */
            if (newsCenterPopup) {
                newsCenterPopup.style.display = 'none'; /* cite: 107 */
            }
        }

        // Função para buscar as últimas notícias e exibi-las no popup
        async function fetchLatestNews() {
            const newsPopupContent = document.getElementById('news-popup-content'); /* cite: 108 */
            newsPopupContent.innerHTML = '<p>Carregando últimas notícias...</p>'; /* cite: 108 */
            try {
                const newsSnapshot = await firestore.collection('news')
                    .orderBy('createdAt', 'desc')
                    .limit(5) // Limita a 5 notícias para o popup
                    .get(); /* cite: 109 */
                if (newsSnapshot.empty) {
                    newsPopupContent.innerHTML = '<p>Nenhuma notícia encontrada.</p>'; /* cite: 110 */
                    return;
                }

                newsPopupContent.innerHTML = ''; /* cite: 111 */
                // Limpa o conteúdo existente
                newsSnapshot.forEach(doc => {
                    const news = doc.data();
                    const newsItem = document.createElement('div');
                    newsItem.classList.add('news-popup-item'); // Use uma classe específica para o popup
                    
                    const timestampDate = news.createdAt ? news.createdAt.toDate() : new Date(); /* cite: 112 */
                    const timeString = timestampDate.toLocaleString([], {
                        year: 'numeric', month: 'numeric', day: 'numeric',
                        hour: '2-digit', minute: '2-digit' /* cite: 113 */
                    });

                    newsItem.innerHTML = `
                        <h3>${news.title}</h3>
                        <p>${news.description}</p>
                        <small>Categoria: ${news.category}</small><br> ${news.tags && news.tags.length > 0 ? `<small>Tags: ${news.tags.join(', ')}</small><br>` : ''}
                        <small>Publicado em: ${timeString}</small>
                        ${news.imageUrl ? `<img src="${news.imageUrl}" alt="Imagem da Notícia">` : ''} `;
                    newsPopupContent.appendChild(newsItem); /* cite: 116 */
                });

            } catch (error) {
                console.error("Erro ao buscar últimas notícias para o popup:", error); /* cite: 117 */
                newsPopupContent.innerHTML = `<p style="color: red;">Erro ao carregar notícias: ${error.message}</p>`; /* cite: 117 */
            }
        }

        // Removidas funções para o Chat Popup: showChatPopup, hideChatPopup, loadChatPopupContent

        // --- Funções de Autenticação (EXISTENTES) ---
        const providerGoogle = new firebase.auth.GoogleAuthProvider(); /* cite: 118 */
        const providerGitHub = new firebase.auth.GithubAuthProvider(); /* cite: 118 */

        document.getElementById('login-google').addEventListener('click', () => {
            auth.signInWithPopup(providerGoogle)
                .catch(error => {
                    console.error("Erro no login com Google:", error);
                });
        });
        document.getElementById('login-github').addEventListener('click', () => {
            auth.signInWithPopup(providerGitHub)
                .catch(error => {
                    console.error("Erro no login com GitHub:", error);
                });
        }); /* cite: 119 */
        function handleLogout() {
            auth.signOut().then(() => {
                console.log("Usuário deslogado.");
            }).catch((error) => {
                console.error("Erro ao deslogar:", error);
            }); /* cite: 121 */
        }
        const logoutButton = document.getElementById('logout-button'); /* cite: 122 */
        if (logoutButton) {
            logoutButton.addEventListener('click', handleLogout); /* cite: 123 */
        }

        // --- Gerenciamento de Estado de Autenticação ---
        auth.onAuthStateChanged(async (user) => {
            currentUser = user; // Define o currentUser globalmente
            const userInfo = document.getElementById('user-info');
            const loginGoogleButton = document.getElementById('login-google');
            const loginGitHubButton = document.getElementById('login-github');
            const logoutButton = document.getElementById('logout-button'); /* cite: 124 */
            const userProfilePic = document.getElementById('user-profile-pic'); /* cite: 124 */
            const googleAppsButton = document.getElementById('google-apps-button'); /* cite: 124 */
            const userInfoContainer = document.getElementById('user-info-container'); /* cite: 124 */
            const googleAppsPopup = document.getElementById('google-apps-popup'); /* cite: 124 */
            const customAppCssStyleTag = document.getElementById('custom-app-css'); /* cite: 124 */
            const contentFrame = document.getElementById('contentFrame'); /* cite: 124 */
            const accessDeniedMessage = document.getElementById('access-denied-message'); /* cite: 125 */
            const bannedMessage = document.getElementById('banned-message'); /* cite: 125 */
            // const notificationBellButton = document.getElementById('notification-bell-button'); // REMOVED /* cite: 126 */
            const newsButton = document.getElementById('news-button'); /* cite: 127 */
            const newsCenterPopup = document.getElementById('news-center-popup'); /* cite: 127 */
            // const chatButton = document.getElementById('chat-button'); // REMOVED /* cite: 127 */
            // const chatPopup = document.getElementById('chat-popup'); // REMOVED /* cite: 128 */


            if (user) {
                if (userInfo) userInfo.textContent = `Olá, ${user.displayName || user.email}!`; /* cite: 129 */
                if (loginGoogleButton) loginGoogleButton.style.display = 'none'; /* cite: 129 */
                if (loginGitHubButton) loginGitHubButton.style.display = 'none'; /* cite: 130 */
                if (user.photoURL) {
                    if (userProfilePic) {
                        userProfilePic.src = user.photoURL; /* cite: 131 */
                        userProfilePic.style.display = 'inline-block'; /* cite: 131 */
                    }
                } else {
                    if (userProfilePic) userProfilePic.style.display = 'none'; /* cite: 132 */
                }
                if (googleAppsButton) googleAppsButton.style.display = 'inline-block'; /* cite: 133 */
                if (userInfoContainer) userInfoContainer.style.display = 'flex'; /* cite: 133 */

                await createUserProfileDocument(user);

                let isUserBanned = false; /* cite: 134 */
                try {
                    const userProfileRef = firestore.collection('users').doc(user.uid); /* cite: 135 */
                    const doc = await userProfileRef.get(); /* cite: 135 */

                    if (doc.exists && doc.data()) {
                        isUserBanned = doc.data().isBan || false; /* cite: 136 */
                    }
                } catch (error) {
                    console.error("Erro ao verificar perfil de usuário ou status de banimento:", error); /* cite: 137 */
                    isUserBanned = false; /* cite: 137 */
                }

                isCurrentUserBanned = isUserBanned; /* cite: 138 */
                if (isUserBanned) {
                    console.warn(`Usuário ${user.uid} está banido.`); /* cite: 139 */
                    setNavLinksEnabled(false); /* cite: 139 */
                    if (logoutButton) {
                        logoutButton.style.display = 'none'; /* cite: 140 */
                        logoutButton.removeEventListener('click', handleLogout); /* cite: 140 */
                    }
                    loadPage('recepcao.html', false); /* cite: 141 */
                    if (bannedMessage) bannedMessage.style.display = 'block'; /* cite: 141 */
                    if (contentFrame) contentFrame.style.display = 'none'; /* cite: 142 */
                    if (googleAppsButton) {
                        googleAppsButton.style.pointerEvents = 'none'; /* cite: 143 */
                        googleAppsButton.style.opacity = '0.6'; /* cite: 143 */
                    }
                    if (googleAppsPopup) googleAppsPopup.style.display = 'none'; /* cite: 144 */
                    if (newsButton) newsButton.style.display = 'none'; /* cite: 144 */
                    if (newsCenterPopup) newsCenterPopup.style.display = 'none'; /* cite: 144 */
                    // if (chatButton) chatButton.style.display = 'none'; // REMOVED /* cite: 145 */
                    // if (chatPopup) chatPopup.style.display = 'none'; // REMOVED /* cite: 146 */
                } else { // User is not banned
                    if (logoutButton) logoutButton.style.display = 'inline-block'; /* cite: 147 */
                    setNavLinksEnabled(true); // Enable all links if not banned /* cite: 147 */
                    if (bannedMessage) bannedMessage.style.display = 'none'; /* cite: 147 */
                    if (contentFrame) contentFrame.style.display = 'block'; /* cite: 148 */
                    if (accessDeniedMessage) accessDeniedMessage.style.display = 'none'; /* cite: 149 */
                    if (googleAppsButton) {
                        googleAppsButton.style.pointerEvents = 'auto'; /* cite: 150 */
                        googleAppsButton.style.opacity = '1'; /* cite: 150 */
                    }
                    // if (notificationBellButton) notificationBellButton.style.display = 'inline-block'; // REMOVED /* cite: 151 */
                    if (newsButton) newsButton.style.display = 'inline-block'; /* cite: 152 */
                    // if (chatButton) chatButton.style.display = 'inline-block'; // REMOVED /* cite: 152 */

                    await loadAndApplyUserAppsCSS(user.uid); /* cite: 153 */
                    // listenForNotifications(); // REMOVED /* cite: 153 */

                }

            } else { // Usuário deslogado
                currentUser = null; /* cite: 154 */
                if (userInfo) userInfo.textContent = ''; /* cite: 154 */
                if (loginGoogleButton) loginGoogleButton.style.display = 'inline-block'; /* cite: 154 */
                if (loginGitHubButton) loginGitHubButton.style.display = 'inline-block'; /* cite: 154 */
                if (logoutButton) logoutButton.style.display = 'none'; /* cite: 155 */
                isCurrentUserBanned = false; /* cite: 155 */
                if (bannedMessage) bannedMessage.style.display = 'none'; /* cite: 155 */
                setNavLinksEnabled(false); /* cite: 155 */
                loadPage('recepcao.html', false); /* cite: 156 */
                if (userProfilePic) {
                    userProfilePic.style.display = 'none'; /* cite: 157 */
                    userProfilePic.src = ''; /* cite: 157 */
                }
                if (googleAppsButton) googleAppsButton.style.display = 'none'; /* cite: 158 */
                if (userInfoContainer) userInfoContainer.style.display = 'none'; /* cite: 158 */
                if (googleAppsPopup) googleAppsPopup.style.display = 'none'; /* cite: 158 */
                if (customAppCssStyleTag) customAppCssStyleTag.innerHTML = ''; /* cite: 158 */
                if (contentFrame) contentFrame.style.display = 'block'; /* cite: 159 */
                if (accessDeniedMessage) accessDeniedMessage.style.display = 'none'; /* cite: 159 */
                // if (notificationBellButton) notificationBellButton.style.display = 'none'; // REMOVED /* cite: 160 */
                if (newsButton) newsButton.style.display = 'none'; /* cite: 161 */
                if (newsCenterPopup) newsCenterPopup.style.display = 'none'; /* cite: 161 */
                // if (chatButton) chatButton.style.display = 'none'; // REMOVED /* cite: 162 */
                // if (chatPopup) chatPopup.style.display = 'none'; // REMOVED /* cite: 163 */
                // updateNotificationBadge(0); // REMOVED /* cite: 164 */
                // if (unsubscribeNotifications) { // REMOVED /* cite: 165 */
                //     unsubscribeNotifications(); /* cite: 165 */
                //     unsubscribeNotifications = null; /* cite: 165 */
                // }
                // hideNotificationsPopup(); // REMOVED /* cite: 166 */
                hideNewsPopup(); /* cite: 166 */
                // hideChatPopup(); // REMOVED /* cite: 167 */
            }
            if (componentHandler) {
                componentHandler.upgradeDom(); /* cite: 168 */
            }
        });

        // --- Event Listeners DOMContentLoaded ---
        document.addEventListener('DOMContentLoaded', () => {
            // Re-obter referências aos elementos DOM dentro deste escopo
            const googleAppsButton = document.getElementById('google-apps-button');
            const googleAppsPopup = document.getElementById('google-apps-popup');
            // const notificationBellButton = document.getElementById('notification-bell-button'); // REMOVED /* cite: 169 */
            // const notificationsCenterPopup = document.getElementById('notifications-center-popup'); // REMOVED /* cite: 169 */
            // const closeNotificationsPopupButton = document.getElementById('close-notifications-popup-button'); // REMOVED /* cite: 169 */
            // const viewAllChatMessagesButton = document.getElementById('view-all-chat-messages-button'); // REMOVED /* cite: 169 */
            const navLinks = document.querySelectorAll('.mdl-navigation__link');

            // Get references for news popup elements (kept)
            const newsButton = document.getElementById('news-button'); /* cite: 170 */
            const newsCenterPopup = document.getElementById('news-center-popup'); /* cite: 170 */
            const closeNewsPopupButton = document.getElementById('close-news-popup-button'); /* cite: 170 */
            const viewAllNewsButton = document.getElementById('view-all-news-button'); /* cite: 171 */
            // Removidas referências para chat popup elements

            // --- Adicionar Event Listeners ---

            // Botão Google Apps (mantido, mas modificado)
            if (googleAppsButton) {
                googleAppsButton.addEventListener('click', (event) => {
                    event.stopPropagation(); // Evita que o clique se propague para o document /* cite: 172 */
                    if (googleAppsPopup.style.display === 'block') {
                        googleAppsPopup.style.display = 'none';
                    } else {
                        googleAppsPopup.style.display = 'block'; /* cite: 173 */
                        // Carregar apps dinamicamente (MODIFIED: hardcoded apps)
                        const appGrid = document.getElementById('app-grid');
                        appGrid.innerHTML = ''; // Clear existing content

                        // MODIFIED: Hardcoded list of WZZM services
                        const wzzmServices = [
                            { name: 'Office WZZM', url: 'https://office.wzzm.org', iconUrl: 'https://wzzm.org/iconmagic.png' },
                            { name: 'Escolar WZZM', url: 'https://escolar.wzzm.org', iconUrl: 'https://wzzm.org/iconmagic.png' },
                            { name: 'Minha Persona WZZM', url: 'https://minhapersona.wzzm.org', iconUrl: 'https://wzzm.org/iconmagic.png' },
                            { name: 'Wiki Zero', url: 'https://wikizero.wzzm.org/', iconUrl: 'https://wzzm.org/iconmagic.png' },
                            { name: 'UWG Wikidot', url: 'https://uwg.wikidot.com', iconUrl: 'https://wzzm.org/iconmagic.png' },
                            { name: 'Wiki Metro SP', url: 'https://wikimetrosp.miraheze.org', iconUrl: 'https://wzzm.org/wikimetrosp.png' }
                        ];

                        wzzmServices.forEach(app => {
                            const appItem = document.createElement('div');
                            appItem.classList.add('app-item'); /* cite: 177 */
                            appItem.innerHTML = `
                                <img src="${app.iconUrl}" alt="${app.name}"> <span>${app.name}</span> `;
                            appItem.addEventListener('click', () => {
                                window.open(app.url, '_blank'); // Opens in a new tab for external services
                                googleAppsPopup.style.display = 'none'; // Close the popup
                            }); /* cite: 180, 181 */
                            appGrid.appendChild(appItem); /* cite: 182 */
                        });
                    }
                }); /* cite: 187 */
            }

            // Removidos Event Listeners para Notificações (Sino e Popup)
            // Removidos Event Listeners para Chat (Botão e Popup)

            // Event Listeners for News Button and Popup (mantidos)
            if (newsButton) {
                newsButton.addEventListener('click', (event) => {
                    event.stopPropagation(); /* cite: 188 */
                    if (newsCenterPopup.style.display === 'flex') {
                        hideNewsPopup();
                    } else {
                        // hideNotificationsPopup(); // REMOVED /* cite: 189 */
                        // hideChatPopup(); // REMOVED /* cite: 189 */
                        showNewsPopup(); /* cite: 189 */
                    }
                }); /* cite: 190 */
            }

            if (closeNewsPopupButton) {
                closeNewsPopupButton.addEventListener('click', () => {
                    hideNewsPopup();
                }); /* cite: 191 */
            }

            if (viewAllNewsButton) {
                viewAllNewsButton.addEventListener('click', () => {
                    loadPage('visualizarnoticias.html', false); // Load the full news page
                    hideNewsPopup(); // Hide the popup
                }); /* cite: 192 */
            }

            // Listener global para fechar popups ao clicar fora (ajustado)
            document.addEventListener('click', (event) => {
                // Fecha o popup de apps se clicar fora dele
                if (googleAppsPopup && googleAppsPopup.style.display === 'block' &&
                    !googleAppsButton.contains(event.target) && /* cite: 193 */
                    !googleAppsPopup.contains(event.target)) {
                    googleAppsPopup.style.display = 'none';
                }

                // Removida lógica para fechar popup de notificações
                // Removida lógica para fechar popup do chat /* cite: 194 */

                // Fecha o popup de notícias se clicar fora dele (mantido)
                if (newsCenterPopup && newsCenterPopup.style.display === 'flex' &&
                    !newsButton.contains(event.target) &&
                    !newsCenterPopup.contains(event.target)) { /* cite: 195 */
                    newsCenterPopup.style.display = 'none';
                }
            }); /* cite: 196 */
            // Adiciona event listener para links de navegação no drawer (ajustado)
            navLinks.forEach(link => {
                link.addEventListener('click', function(event) {
                    const pageSrc = this.getAttribute('onclick'); // Get the raw onclick attribute
                    let actualPageSrc = '';
                    let requiresAuth = false; /* cite: 197 */

                    // Extract actual page source and requiresAuth
                    if (pageSrc && pageSrc.includes("loadPage(")) {
                        const match = pageSrc.match(/loadPage\('([^']*)', (true|false)\)/);
                        if (match) { /* cite: 198 */
                            actualPageSrc = match[1]; /* cite: 198 */
                            requiresAuth = match[2] === 'true'; /* cite: 198 */
                        }
                    }
                    // Removido o tratamento especial para chat popup no drawer


                    if (isCurrentUserBanned && !actualPageSrc.includes('POL%C3%8DTICAS%20GERAIS%20DO%20WIKI%20ZONE%20ZERO%20MOD.pdf')) {
                        event.preventDefault(); /* cite: 200 */
                        return;
                    }

                    if (this.classList.contains('disabled') && !actualPageSrc.includes('POL%C3%8DTICAS%20GERAIS%20DO%20WIKI%20ZONE%20ZERO%20MOD.pdf')) {
                        event.preventDefault(); /* cite: 201 */
                        return;
                    }

                    if (actualPageSrc.includes('POL%C3%8DTICAS%20GERAIS%20DO%20WIKI%20ZONE%20ZERO%20MOD.pdf')) {
                        return; /* cite: 202 */
                    }

                    event.preventDefault(); /* cite: 203 */
                    loadPage(actualPageSrc, requiresAuth); /* cite: 203 */
                    // Fecha o drawer do MDL se estiver aberto
                    if (document.querySelector('.mdl-layout__drawer.is-visible')) {
                        document.querySelector('.mdl-layout__obfuscator').classList.remove('is-visible'); /* cite: 204 */
                        document.querySelector('.mdl-layout__drawer').classList.remove('is-visible'); /* cite: 204 */
                    }
                });
            }); /* cite: 205 */
            // Inicializa componentes MDL
            if (componentHandler) {
                componentHandler.upgradeDom(); /* cite: 206 */
            }
        });

	    // Utilitário para gerar IDs únicos
function uniqueID() {
    return 'win_' + Math.random().toString(36).substr(2, 9);
}

// Função para criar uma nova janela flutuante
function createFloatingWindow(src, title) {
    const container = document.getElementById('window-container');
    
    // ADICIONE AQUI:
    const existing = Array.from(document.querySelectorAll('.floating-window'))
        .find(win => win.getAttribute('data-src') === src);
    if (existing) {
        bringWindowToFront(existing);
        return;
    }
    const winId = uniqueID();

    // Elemento da janela
    const win = document.createElement('div');
    win.className = 'floating-window';
    win.setAttribute('data-winid', winId);

    // Cabeçalho da janela
    const header = document.createElement('div');
    header.className = 'window-header';
    header.innerHTML = `
        <span>${title || src}</span>
        <span class="window-controls">
            <button title="Minimizar" onclick="minimizeWindow('winId_aqui')">_</button>
            <button title="Fechar" onclick="closeWindow('${winId}')">&times;</button>
        </span>
    `;

    // Corpo da janela com iframe
    const body = document.createElement('div');
    body.className = 'window-body';
    const iframe = document.createElement('iframe');
    iframe.src = src;
    body.appendChild(iframe);

    win.appendChild(header);
    win.appendChild(body);
    container.appendChild(win);

    // Torna a janela arrastável
    makeWindowDraggable(win, header);

    // Foca a janela ao clicar
    win.addEventListener('mousedown', () => {
        bringWindowToFront(win);
    });

    // Coloca no topo ao criar
    bringWindowToFront(win);
}

// Deixe a janela arrastável
function makeWindowDraggable(win, handle) {
    let offsetX = 0, offsetY = 0, dragging = false;

    handle.addEventListener('mousedown', function (e) {
        dragging = true;
        offsetX = e.clientX - win.offsetLeft;
        offsetY = e.clientY - win.offsetTop;
        win.style.zIndex = getNextZIndex();
        document.body.style.userSelect = 'none';
    });

    document.addEventListener('mousemove', function (e) {
        if (dragging) {
            win.style.left = (e.clientX - offsetX) + 'px';
            win.style.top = (e.clientY - offsetY) + 'px';
        }
    });

    document.addEventListener('mouseup', function () {
        dragging = false;
        document.body.style.userSelect = '';
    });
}

// Função para minimizar janela
function minimizeWindow(winId) {
    const win = document.querySelector(`.floating-window[data-winid="${winId}"]`);
    if (!win) return;
    const body = win.querySelector('.window-body');
    if (body.style.display === 'none') {
        body.style.display = '';
        win.style.height = win.dataset.originalHeight || '450px';
    } else {
        win.dataset.originalHeight = win.style.height;
        body.style.display = 'none';
        win.style.height = '';
    }
}

// Função para fechar janela
function closeWindow(winId) {
    const win = document.querySelector(`.floating-window[data-winid="${winId}"]`);
    if (win) win.remove();
}

// Z-Index para trazer para frente
let topZ = 1000;
function getNextZIndex() {
    return ++topZ;
}
function bringWindowToFront(win) {
    win.style.zIndex = getNextZIndex();
}

// Substitua a função loadPage
function loadPage(src, requiresAuth = false) {
    // Adapte regras de autenticação/banimento se necessário!
    // Exemplo: se quiser impedir múltiplas janelas iguais, faça uma busca aqui
    createFloatingWindow(src, src.split('/').pop());
}
    </script>
</body>
</html>
